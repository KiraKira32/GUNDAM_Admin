import{D as y,T as x,M as r,a as k}from"./ToastMessages-c621d328.js";import{_ as b,o as l,c as i,a as t,b as c,v as p,j as $,r as h,d as _,F as D,h as L,t as m}from"./index-de1f4ca7.js";const N={props:["tempCoupon","isNew"],data(){return{due_date:""}},emits:["update-coupon"],watch:{tempCoupon:{immediate:!0,handler(){const o=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=o}},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}}},T={id:"couponModal",class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},S={class:"modal-dialog"},U={class:"modal-content"},V={class:"modal-header bg-dark text-white"},B={class:"modal-title",id:"exampleModalLabel"},I={key:0},A={key:1},F=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),j={class:"modal-body"},z={class:"mb-3"},E=t("label",{for:"title"},"優惠卷名稱",-1),O={class:"mb-3"},P=t("label",{for:"coupon_code"},"優惠碼",-1),q={class:"mb-3"},G=t("label",{for:"due_date"},"優惠卷時間",-1),H={class:"mb-3"},J=t("label",{for:"percent"},"折扣百分比",-1),K={class:"mb-3"},Q={class:"form-check"},R=t("label",{class:"form-check-label",for:"is_enabled"}," 啟動優惠碼 ",-1),W={class:"modal-footer"},X=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1),Y=["disabled"];function Z(o,e,s,C,a,u){return l(),i("div",T,[t("div",S,[t("div",U,[t("div",V,[t("h5",B,[s.isNew?(l(),i("span",I,"新增優惠卷")):(l(),i("span",A,"編輯優惠卷"))]),F]),t("div",j,[t("div",z,[E,c(t("input",{type:"text",class:"form-control mt-2",id:"title","onUpdate:modelValue":e[0]||(e[0]=n=>s.tempCoupon.title=n),placeholder:"請輸入優惠卷名稱"},null,512),[[p,s.tempCoupon.title]])]),t("div",O,[P,c(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>s.tempCoupon.code=n),type:"text",class:"form-control mt-2",id:"coupon_code",placeholder:"請輸入優惠碼"},null,512),[[p,s.tempCoupon.code]])]),t("div",q,[G,c(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>a.due_date=n),type:"date",class:"form-control mt-2",id:"due_date"},null,512),[[p,a.due_date]])]),t("div",H,[J,c(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>s.tempCoupon.percent=n),type:"number",class:"form-control mt-2",id:"perrcent",min:"0",placeholder:"請輸入折扣百分比"},null,512),[[p,s.tempCoupon.percent]])]),t("div",K,[t("div",Q,[c(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>s.tempCoupon.is_enabled=n),type:"checkbox",class:"form-check-input","true-value":1,"false-value":0,id:"is_enabled"},null,512),[[$,s.tempCoupon.is_enabled]]),R])])]),t("div",W,[X,t("button",{type:"button",class:"btn btn-danger",disabled:!s.tempCoupon.is_enabled,onClick:e[5]||(e[5]=n=>o.$emit("update-coupon",s.tempCoupon))},"確認",8,Y)])])])],512)}const tt=b(N,[["render",Z]]);const et={components:{CouponModal:tt,DeleteModal:y,ToastMessages:x},data(){return{coupons:{},tempCoupon:{title:"",is_enabled:0,percent:100,due_date:"",code:""},isLoading:!1,isNew:!1,title:"",message:""}},methods:{openModal(o,e){o==="create"?(this.isNew=!0,this.couponModal.show(),this.tempCoupon={due_date:new Date().getTime()/1e3}):o==="edit"?(this.isNew=!1,this.couponModal.show(),this.tempCoupon={...e}):o==="delete"&&(this.deleteModal.show(),this.tempCoupon={...e})},toastShow(o,e,s){this.title=o,this.message=e,setTimeout(()=>{this.toastMessage.show()},700),setTimeout(()=>{this.toastMessage.hide()},s)},getCoupons(){this.isLoading=!0;const o="https://vue3-course-api.hexschool.io/v2/api/asher_api/admin/coupons";this.$http.get(o,this.tempProduct).then(e=>{this.coupons=e.data.coupons,this.isLoading=!1}).catch(e=>{alert(e)})},updateCoupon(){let o="https://vue3-course-api.hexschool.io/v2/api/asher_api/admin/coupon",e="post",s=this.tempCoupon;this.isNew||(o=`https://vue3-course-api.hexschool.io/v2/api/asher_api/admin/coupon/${this.tempCoupon.id}`,e="put",s=this.tempCoupon),this.$http[e](o,{data:s}).then(()=>{this.isLoading=!1,this.couponModal.hide(),this.getCoupons(),this.isNew===!1?this.toastShow("提示訊息","編輯優惠卷成功",3e3):this.isNew===!0&&(this.isLoading=!0,this.toastShow("提示訊息","新增優惠卷成功",3e3))}).catch(()=>{this.toastShow("提示訊息","請填寫正確資料",3e3)})},deleteCoupon(){const o=`https://vue3-course-api.hexschool.io/v2/api/asher_api/admin/coupon/${this.tempCoupon.id}`;this.$http.delete(o).then(()=>{this.deleteModal.hide(),this.getCoupons(),this.toastShow("提示訊息","刪除優惠卷成功",3e3)})}},mounted(){this.getCoupons(),this.couponModal=new r("#couponModal"),this.deleteModal=new r("#deleteModal"),this.toastMessage=new k("#toastMessage")}},ot={class:"container page-container"},st={class:"products mt-4"},nt=t("h4",{class:"text-fz"}," 優惠管理 ",-1),at=t("hr",null,null,-1),lt={class:"text-end"},it={class:"text-end btn btn-danger",type:"button"},dt={class:"table mt-3"},ut=t("thead",null,[t("tr",{class:"table-block text-white",style:{background:"#282828"}},[t("th",{width:"150"},"優惠卷名稱"),t("th",{width:"120"},"折扣百分比"),t("th",{width:"120"},"優惠卷時間"),t("th",{width:"120"},"優惠卷狀態"),t("th",{width:"120"},"編輯")])],-1),ct={key:0,class:"text-success"},pt={key:1,class:"text-muted"},ht={class:"btn-group"},_t=["onClick"],mt=["onClick"];function rt(o,e,s,C,a,u){const n=h("Loading"),f=h("CouponModal"),v=h("DeleteModal"),g=h("ToastMessages");return l(),i("div",ot,[_(n,{active:a.isLoading,class:"vld-overlay"},null,8,["active"]),t("div",st,[nt,at,t("div",lt,[t("button",it,[t("p",{class:"text-center mx-4",onClick:e[0]||(e[0]=d=>u.openModal("create"))},"新增優惠卷")])]),t("table",dt,[ut,t("tbody",null,[(l(!0),i(D,null,L(a.coupons,(d,w)=>(l(),i("tr",{key:w},[t("td",null,m(d.title),1),t("td",null,m(d.percent),1),t("td",null,m(o.$filters.date(d.due_date)),1),t("td",null,[d.is_enabled===1?(l(),i("span",ct,"啟用")):(l(),i("span",pt,"未啟用"))]),t("td",null,[t("div",ht,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:M=>u.openModal("edit",d)},"編輯",8,_t),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:M=>u.openModal("delete",d)},"刪除",8,mt)])])]))),128))])])]),_(f,{"temp-coupon":a.tempCoupon,"is-new":a.isNew,ref:"couponModal",onUpdateCoupon:u.updateCoupon},null,8,["temp-coupon","is-new","onUpdateCoupon"]),_(v,{item:a.tempCoupon,onDeleteItem:u.deleteCoupon},null,8,["item","onDeleteItem"]),_(g,{title:a.title,message:a.message},null,8,["title","message"])])}const ft=b(et,[["render",rt]]);export{ft as default};
