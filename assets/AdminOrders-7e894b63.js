import{T as D,D as C,M as b,a as Y}from"./ToastMessages-46679928.js";import{P}from"./PaginationComponent-a8ac968b.js";import{_ as g,o as l,c as d,a as t,t as o,i as f,F as m,h as p,b as y,j as M,r as _,d as u}from"./index-810af931.js";const T={props:["tempOrder"],data(){return{order:{},isPaid:!1}},emits:["update-paid"]},L={id:"orderModal",ref:"orderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},N={class:"modal-dialog modal-xl"},A={class:"modal-content border-0"},V=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"orderModal"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),E={class:"modal-body"},S={class:"row"},U={class:"col-md-4"},H=t("h3",null,"客戶資料",-1),B={class:"table"},j={key:0},q=t("th",{style:{width:"100px"}},"姓名",-1),z=t("th",null,"Email",-1),F=t("th",null,"電話",-1),I=t("th",null,"地址",-1),G=t("th",null,"備註",-1),J={class:"col-md-8"},K=t("h3",null,"訂單資料",-1),Q={class:"table"},R=t("th",{style:{width:"100px"}},"訂單編號",-1),W=t("th",null,"下單時間",-1),X=t("th",null,"付款時間",-1),Z={key:0},tt={key:1},et=t("th",null,"付款狀態",-1),st={key:0,class:"text-success"},ot={key:1,class:"text-danger"},lt=t("th",null,"訂單總金額",-1),dt=t("h3",null,"商品資訊",-1),nt={class:"table"},at=t("thead",null,[t("tr")],-1),it={width:"50"},rt={width:"100",class:"text-end mx-2"},ct={class:"d-flex justify-content-end"},ht={class:"form-check"},_t={class:"form-check-label",for:"flexCheckDefault"},ut={key:0},mt={key:1},pt={class:"modal-footer"},bt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function gt(s,n,e,v,r,c){return l(),d("div",L,[t("div",N,[t("div",A,[V,t("div",E,[t("div",S,[t("div",U,[H,t("table",B,[e.tempOrder.user?(l(),d("tbody",j,[t("tr",null,[q,t("td",null,o(e.tempOrder.user.name),1)]),t("tr",null,[z,t("td",null,o(e.tempOrder.user.email),1)]),t("tr",null,[F,t("td",null,o(e.tempOrder.user.tel),1)]),t("tr",null,[I,t("td",null,o(e.tempOrder.user.address),1)]),t("tr",null,[G,t("td",null,o(e.tempOrder.message),1)])])):f("",!0)])]),t("div",J,[K,t("table",Q,[t("tbody",null,[t("tr",null,[R,t("td",null,o(e.tempOrder.id),1)]),t("tr",null,[W,t("td",null,o(s.$moment(new Date(e.tempOrder.create_at*1e3)).format("YYYY-MM-DD HH:mm")),1)]),t("tr",null,[X,t("td",null,[e.tempOrder.paid_date?(l(),d("span",Z,o(s.$moment(new Date(e.tempOrder.create_at*1e3)).format("YYYY-MM-DD HH:mm")),1)):(l(),d("span",tt,"時間不正確"))])]),t("tr",null,[et,t("td",null,[e.tempOrder.is_paid?(l(),d("strong",st,"已付款")):(l(),d("span",ot,"尚未付款"))])]),t("tr",null,[lt,t("td",null,"NT$ "+o(s.$filters.currency(e.tempOrder.total)),1)])])]),dt,t("table",nt,[at,t("tbody",null,[(l(!0),d(m,null,p(e.tempOrder.products,i=>(l(),d("tr",{key:i.id},[t("th",null,o(i.product.title),1),t("td",it,o(i.qty)+" "+o(i.product.unit),1),t("td",rt," NT$ "+o(s.$filters.currency(i.final_total)),1)]))),128))])]),t("div",ct,[t("div",ht,[y(t("input",{"onUpdate:modelValue":n[0]||(n[0]=i=>e.tempOrder.is_paid=i),value:"",class:"form-check-input",type:"checkbox",id:"flexCheckDefault"},null,512),[[M,e.tempOrder.is_paid]])]),t("label",_t,[e.tempOrder.is_paid?(l(),d("span",ut,"已付款")):(l(),d("span",mt,"未付款"))])])])])]),t("div",pt,[bt,t("button",{type:"button",class:"btn btn-danger",onClick:n[1]||(n[1]=i=>s.$emit("update-paid",e.tempOrder))},"確認修改")])])])],512)}const ft=g(T,[["render",gt]]);const yt={data(){return{orders:[],isNew:!1,isLoading:!1,tempOrder:{},page:1,title:"",message:""}},components:{Pagination:P,OrderModal:ft,ToastMessages:D,DeleteModal:C},methods:{getOrders(s=1){const n=`https://vue3-course-api.hexschool.io/v2/api/asher_api/admin/orders/?page=${s}`;this.isLoading=!0,this.$http.get(n).then(e=>{this.orders=e.data.orders,this.page=e.data.pagination,this.isLoading=!1}).catch(e=>{console.log(e)})},openModal(s,n){s==="view"?(this.orderModal.show(),this.tempOrder={...n}):s==="delete"?(this.deleteModal.show(),this.tempOrder={...n}):s==="deldeteAll"&&this.deleteModal.show()},toastShow(s,n,e){this.title=s,this.message=n,setTimeout(()=>{this.toastMessage.show()},700),setTimeout(()=>{this.toastMessage.hide()},e)},updatePaid(s){const n={is_paid:s.is_paid},e=`https://vue3-course-api.hexschool.io/v2/api/asher_api/admin/order/${s.id}`;this.$http.put(e,{data:n}).then(()=>{this.orderModal.hide(),this.getOrders(this.page),this.toastShow("提示訊息","編輯訂單成功",3e3)}).catch(()=>{alert("更新失敗")})},deleteOrder(){const s=`https://vue3-course-api.hexschool.io/v2/api/asher_api/admin/order/${this.tempOrder.id}`;this.$http.delete(s).then(()=>{this.getOrders(),this.deleteModal.hide(),this.toastShow("提示訊息","刪除該筆訂單成功",3e3)})},deleteAll(){const s="https://vue3-course-api.hexschool.io/v2/api/asher_api/admin/orders/all";this.$http.delete(s).then(()=>{this.getOrders(),this.deleteModal.hide(),this.toastShow("提示訊息","刪除全部訂單成功",4e3)})}},mounted(){this.getOrders(),this.orderModal=new b("#orderModal"),this.toastMessage=new Y("#toastMessage"),this.deleteModal=new b("#deleteModal")}},Mt={class:"container page-container"},vt={class:"products mt-4"},Ot=t("h4",{class:"text-fz"},"訂單管理",-1),xt=t("hr",null,null,-1),kt={class:"text-end"},wt=t("p",{class:"text-center mx-3"},"刪除全部訂單",-1),$t=[wt],Dt={class:"table mt-3 align-middle"},Ct=t("thead",null,[t("tr",{class:"table-block text-white",style:{background:"#282828"}},[t("th",{width:"100"},"訂單日期"),t("th",{width:"120"},"E-mail"),t("th",null,"商品資訊"),t("th",{width:"90"},"金額"),t("th",{width:"85"},"付款狀態"),t("th",{width:"110"},"編輯")])],-1),Yt={class:"order-text-content"},Pt=["textContent"],Tt={class:"order-text-content"},Lt={class:"list-unstyled"},Nt={class:"text-right order-text-content"},At=["id","onUpdate:modelValue"],Vt=["for"],Et={key:0,class:"text-primary fw-bolder order-text-content"},St={key:1,class:"text-muted",style:{"font-size":"15px"}},Ut={class:"btn-group"},Ht=["onClick"],Bt=["onClick"];function jt(s,n,e,v,r,c){const i=_("Loading"),O=_("Pagination"),x=_("OrderModal"),k=_("ToastMessages"),w=_("DeleteModal");return l(),d("div",Mt,[u(i,{active:r.isLoading,class:"vld-overlay"},null,8,["active"]),t("div",vt,[Ot,xt,t("div",kt,[t("button",{class:"text-end btn btn-danger",type:"button",onClick:n[0]||(n[0]=(...a)=>c.deleteAll&&c.deleteAll(...a))},$t)]),t("table",Dt,[Ct,t("tbody",null,[(l(!0),d(m,null,p(r.orders,a=>(l(),d("tr",{key:a.id},[t("td",Yt,o(s.$moment(new Date(a.create_at*1e3)).format("YYYY-MM-DD")),1),t("td",null,[a.user?(l(),d("span",{key:0,textContent:o(a.user.email),class:"order-text-content"},null,8,Pt)):f("",!0)]),t("td",Tt,[t("ul",Lt,[(l(!0),d(m,null,p(a.products,(h,$)=>(l(),d("li",{key:$},o(h.product.title)+"-"+o(h.qty)+o(h.product.unit),1))),128))])]),t("td",Nt," NT$ "+o(s.$filters.currency(a.total)),1),t("td",null,[y(t("input",{class:"form-check-input me-1",type:"checkbox",role:"switch",id:a.id,"onUpdate:modelValue":h=>a.is_paid=h},null,8,At),[[M,a.is_paid]]),t("label",{class:"form-check-label",for:a.id},[a.is_paid?(l(),d("span",Et,"已付款")):(l(),d("span",St,"未付款"))],8,Vt)]),t("td",null,[t("div",Ut,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:h=>c.openModal("view",a)}," 檢視 ",8,Ht),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:h=>c.openModal("delete",a)}," 刪除 ",8,Bt)])])]))),128))])])]),u(O,{pages:r.page,onEmitPages:c.getOrders,ref:"orderModal"},null,8,["pages","onEmitPages"]),u(x,{"temp-order":r.tempOrder,onUpdatePaid:c.updatePaid,ref:"orderModal"},null,8,["temp-order","onUpdatePaid"]),u(k,{title:r.title,message:r.message},null,8,["title","message"]),u(w,{item:r.tempOrder,onDeleteItem:c.deleteOrder},null,8,["item","onDeleteItem"])])}const It=g(yt,[["render",jt]]);export{It as default};
